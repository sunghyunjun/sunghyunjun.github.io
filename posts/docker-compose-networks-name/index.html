<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Compose Networks 이름 설정하기 | Sunghyun Jun Dev Note</title><meta name=keywords content="docker-compose"><meta name=description content="Docker Compose networks 설정을 했을 때, docker network ls를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.
이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.
docker-compose-without-networks-name.yml
version: '3.9' services: hello-world: image: &#34;hello-world:latest&#34; networks: - foobar # without name property networks: foobar: driver: bridge amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up [+] Running 2/2 ⠿ Network mydir_foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 0."><meta name=author content="Sunghyun Jun"><link rel=canonical href=https://sunghyunjun.github.io/posts/docker-compose-networks-name/><meta name=google-site-verification content="DIWwwU8ckTOPhkZdU_PgbNYw984L1km4b9KMFF6mD5A"><meta name=naver-site-verification content="7a0f56cfc3f5f2d152ff08dd9238b3dcabe5dbfc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://sunghyunjun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sunghyunjun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sunghyunjun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://sunghyunjun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://sunghyunjun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-EFNS08FGBV"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EFNS08FGBV",{anonymize_ip:!1})}</script><meta property="og:title" content="Docker Compose Networks 이름 설정하기"><meta property="og:description" content="Docker Compose networks 설정을 했을 때, docker network ls를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.
이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.
docker-compose-without-networks-name.yml
version: '3.9' services: hello-world: image: &#34;hello-world:latest&#34; networks: - foobar # without name property networks: foobar: driver: bridge amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up [+] Running 2/2 ⠿ Network mydir_foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 0."><meta property="og:type" content="article"><meta property="og:url" content="https://sunghyunjun.github.io/posts/docker-compose-networks-name/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-26T09:00:00+09:00"><meta property="article:modified_time" content="2022-03-26T09:00:00+09:00"><meta property="og:site_name" content="Sunghyun Jun Dev Note"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Compose Networks 이름 설정하기"><meta name=twitter:description content="Docker Compose networks 설정을 했을 때, docker network ls를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.
이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.
docker-compose-without-networks-name.yml
version: '3.9' services: hello-world: image: &#34;hello-world:latest&#34; networks: - foobar # without name property networks: foobar: driver: bridge amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up [+] Running 2/2 ⠿ Network mydir_foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sunghyunjun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Docker Compose Networks 이름 설정하기","item":"https://sunghyunjun.github.io/posts/docker-compose-networks-name/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Compose Networks 이름 설정하기","name":"Docker Compose Networks 이름 설정하기","description":"Docker Compose networks 설정을 했을 때, docker network ls를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.\n이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.\ndocker-compose-without-networks-name.yml\nversion: \u0026#39;3.9\u0026#39; services: hello-world: image: \u0026#34;hello-world:latest\u0026#34; networks: - foobar # without name property networks: foobar: driver: bridge amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up [+] Running 2/2 ⠿ Network mydir_foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 0.","keywords":["docker-compose"],"articleBody":"Docker Compose networks 설정을 했을 때, docker network ls를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.\n이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.\ndocker-compose-without-networks-name.yml\nversion: '3.9' services: hello-world: image: \"hello-world:latest\" networks: - foobar # without name property networks: foobar: driver: bridge amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up [+] Running 2/2 ⠿ Network mydir_foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 0.1s Attaching to mydir-hello-world-1 mydir-hello-world-1 | mydir-hello-world-1 | Hello from Docker! mydir-hello-world-1 | This message shows that your installation appears to be working correctly. ... amiere@LAPTOP-5BV4FPUC:~/mydir$ pwd /home/amiere/mydir amiere@LAPTOP-5BV4FPUC:~/mydir$ docker network ls NETWORK ID NAME DRIVER SCOPE 23aa4273c50b bridge bridge local 060edc7d35a8 host host local 08126381cd1f mydir_foobar bridge local b58714b49b7e none null local ... 위와 같이 compose yaml을 설정하고, mydir directory에서 docker-compose up을 실행하면 NETWORK NAME이 mydir_foobar로 설정되어 생성되는 것을 확인할 수 있습니다.\n이것을 봐서는 network name의 접두사는 기본적으로 docker-compose 명령어가 실행되는 directory로 보입니다. 정확히는 compose project name이 기본 접두사가 되는데, 자세한 내용은 이 글의 후반부에서 다루겠습니다.\n이번에는 compose yaml을 아래와 같이 변경하고 실행을 해보겠습니다. 차이점은 networks 부분에 name이라는 하위 key를 추가로 설정해준 것입니다. 이 설정은 compose file version 3.5 이상에서 적용 가능합니다.\nCompose file version 3.5\ncompose-file-v3/#name-1\ndocker-compose-with-networks-name.yml\nversion: '3.9' services: hello-world: image: \"hello-world:latest\" networks: - foobar # with name property # Compose file version \u003e= 3.5 # https://docs.docker.com/compose/compose-file/compose-versioning/#version-35 networks: foobar: driver: bridge name: foobar amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-with-networks-name.yml up [+] Running 2/2 ⠿ Network foobar Created 0.1s ⠿ Container mydir-hello-world-1 Created 1.0s Attaching to mydir-hello-world-1 mydir-hello-world-1 | mydir-hello-world-1 | Hello from Docker! mydir-hello-world-1 | This message shows that your installation appears to be working correctly. ... amiere@LAPTOP-5BV4FPUC:~/mydir$ docker network ls NETWORK ID NAME DRIVER SCOPE 23aa4273c50b bridge bridge local 14f095601a79 foobar bridge local 060edc7d35a8 host host local b58714b49b7e none null local ... network 하위 key로 name을 설정하면 위와 같이 접두사 없이 name에서 설정한 이름으로 NETWORK NAME이 설정됩니다.\ncompose file version 3.5 이상에서는 networks에 대해 하위 key name을 사용하여 기본적으로 생성되는 접두사 없이 NETWORK NAME을 설정할 수 있습니다.\n한편으로 위의 과정을 살펴보시면 docker-compose up에서 생성되는 container의 이름 또한 자동으로 접두사가 생성되는 것을 확인할 수 있습니다.\n이 부분을 변경하고자 할 경우에는 services 하위 key로 container_name을 설정하면 됩니다.\ncompose-file-v3/#container_name\ndocker-compose-with-name.yml\nversion: '3.9' services: hello-world: container_name: hello-foobar image: \"hello-world:latest\" networks: - foobar # with name property # Compose file version \u003e= 3.5 # https://docs.docker.com/compose/compose-file/compose-versioning/#version-35 networks: foobar: driver: bridge name: foobar amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f docker-compose-with-name.yml up [+] Running 2/2 ⠿ Network foobar Created 0.0s ⠿ Container hello-foobar Created 0.2s Attaching to hello-foobar hello-foobar | hello-foobar | Hello from Docker! hello-foobar | This message shows that your installation appears to be working correctly. ... 위와 같이 container 이름이 접두사 없이 hello-foobar로 설정된 것을 확인할 수 있습니다. container_name의 경우, 아래와 같은 주의사항이 있습니다.\nNote when using docker stack deploy\nThe container_name option is ignored when deploying a stack in swarm mode Docker Compose networks name default prefix networks name 기본 접두사는 어떻게 설정되는 것인지 알아보고자 합니다.\ndocker-compose는 cobra library를 사용합니다.\nCobra is a library for creating powerful modern CLI applications.\n우리가 사용하는 docker-compose 명령어는 아래에서 시작합니다.\n아래의 github source code permalink는 2022년 3월 26일을 기준으로 하였습니다.\ndocker compose v2 compose.go#L228\nfunc RootCommand(dockerCli command.Cli, backend api.Service) *cobra.Command { opts := projectOptions{} var ( ansi string noAnsi bool verbose bool version bool ) command := \u0026cobra.Command{ Short: \"Docker Compose\", Use: PluginName, TraverseChildren: true, ... docker compose v2 compose.go#L293\ncommand.AddCommand( upCommand(\u0026opts, backend), downCommand(\u0026opts, backend), startCommand(\u0026opts, backend), restartCommand(\u0026opts, backend), stopCommand(\u0026opts, backend), ... upCommand, downCommand 등이 우리가 docker-compose up와 같은 명령어를 사용하는 것과 관련 있는 부분입니다.\ndocker compose v2 up.go#L95\nfunc upCommand(p *projectOptions, backend api.Service) *cobra.Command { up := upOptions{} create := createOptions{} upCmd := \u0026cobra.Command{ Use: \"up [SERVICE...]\", Short: \"Create and start containers\", PreRunE: AdaptCmd(func(ctx context.Context, cmd *cobra.Command, args []string) error { create.timeChanged = cmd.Flags().Changed(\"timeout\") return validateFlags(\u0026up, \u0026create) }), RunE: p.WithServices(func(ctx context.Context, project *types.Project, services []string) error { create.ignoreOrphans = utils.StringToBool(project.Environment[\"COMPOSE_IGNORE_ORPHANS\"]) if create.ignoreOrphans \u0026\u0026 create.removeOrphans { return fmt.Errorf(\"COMPOSE_IGNORE_ORPHANS and --remove-orphans cannot be combined\") } return runUp(ctx, backend, create, up, project, services) }), ... 여기서 WithServices 부분을 살펴보면 다음과 같습니다.\ndocker compose v2 compose.go#L119\n// WithServices creates a cobra run command from a ProjectFunc based on configured project options and selected services func (o *projectOptions) WithServices(fn ProjectServicesFunc) func(cmd *cobra.Command, args []string) error { return Adapt(func(ctx context.Context, args []string) error { project, err := o.toProject(args, cli.WithResolvedPaths(true)) if err != nil { return err } return fn(ctx, project, args) }) } 여기서 toProject 를 살펴보면 아래와 같습니다.\ndocker compose v2 compose.go#L153\nfunc (o *projectOptions) toProject(services []string, po ...cli.ProjectOptionsFn) (*types.Project, error) { options, err := o.toProjectOptions(po...) if err != nil { return nil, compose.WrapComposeError(err) } project, err := cli.ProjectFromOptions(options) if err != nil { return nil, compose.WrapComposeError(err) } ... toProjectOptions와 cli.ProjectFromOptions를 살펴보겠습니다.\n먼저 toProjectOptions 를 살펴보면 아래와 같습니다.\ndocker compose v2 compose.go#L207\nfunc (o *projectOptions) toProjectOptions(po ...cli.ProjectOptionsFn) (*cli.ProjectOptions, error) { return cli.NewProjectOptions(o.ConfigPaths, append(po, cli.WithWorkingDirectory(o.ProjectDir), cli.WithEnvFile(o.EnvFile), cli.WithDotEnv, cli.WithOsEnv, cli.WithConfigFileEnv, cli.WithDefaultConfigPath, cli.WithName(o.ProjectName))...) } cli.WithName(o.ProjectNme)과 관련하여 아래와 같이 살펴볼 수 있습니다.\n우선 o.ProjectName은 addProjectFlags에서 설정이 되는데, 이는 우리가 docker-compose -p NAME 옵션을 사용했을 때 설정이 되는 부분입니다.\n우리가 지정한 NAME 을 갖거나, default로 ““으로 설정됩니다.\nDefine and run multi-container applications with Docker. Usage: docker-compose [-f ...] [--profile ...] [options] [COMMAND] [ARGS...] docker-compose -h|--help Options: -f, --file FILE Specify an alternate compose file (default: docker-compose.yml) -p, --project-name NAME Specify an alternate project name (default: directory name) ... docker compose v2 compose.go#L130\nfunc (o *projectOptions) addProjectFlags(f *pflag.FlagSet) { f.StringArrayVar(\u0026o.Profiles, \"profile\", []string{}, \"Specify a profile to enable\") f.StringVarP(\u0026o.ProjectName, \"project-name\", \"p\", \"\", \"Project name\") ... cli.WithName(o.ProjectNme)의 WithName은 아래와 같습니다.\ncompose-spec compose-go cli options.go#L63\nfunc WithName(name string) ProjectOptionsFn { return func(o *ProjectOptions) error { o.Name = name return nil } } 이제 약간 다시 돌아와서 cli.ProjectFromOptions를 살펴보겠습니다.\ncompose-spec compose-go cli options.go#L296\nfunc ProjectFromOptions(options *ProjectOptions) (*types.Project, error) { configPaths, err := getConfigPathsFromOptions(options) ... workingDir, err := options.GetWorkingDir() if err != nil { return nil, err } absWorkingDir, err := filepath.Abs(workingDir) if err != nil { return nil, err } options.loadOptions = append(options.loadOptions, withNamePrecedenceLoad(absWorkingDir, options)) project, err := loader.Load(types.ConfigDetails{ ConfigFiles: configs, WorkingDir: workingDir, Environment: options.Environment, }, options.loadOptions...) ... absWorkingDir, withNamePrecedenceLoad(absWorkingDir, options)을 살펴보겠습니다. 그리고 이어서 loader.Load를 살펴보겠습니다.\ncompose-spec compose-go cli options.go#L350\nfunc withNamePrecedenceLoad(absWorkingDir string, options *ProjectOptions) func(*loader.Options) { return func(opts *loader.Options) { if options.Name != \"\" { opts.SetProjectName(options.Name, true) } else if nameFromEnv, ok := options.Environment[consts.ComposeProjectName]; ok \u0026\u0026 nameFromEnv != \"\" { opts.SetProjectName(nameFromEnv, true) } else { opts.SetProjectName(filepath.Base(absWorkingDir), false) } } } 바로 여기서 options.Name == \"\" 일 경우에 opts.SetProjcetName 기본 설정이 이루어지게 됩니다. docker compose -p NAME의 NAME을 전달하지 않을 경우 이곳에서 환경설정을 통해 설정이 되거나 filepath.Base(absWorkingDir)에 의해 설정되게 됩니다.\n즉 docker compose project name이 절대경로 이름의 base가 되는 것입니다.\ncompose-spec compose-go loader loader.go#L70\nfunc (o *Options) SetProjectName(name string, imperativelySet bool) { o.projectName = normalizeProjectName(name) o.projectNameImperativelySet = imperativelySet } 이제 cli.ProjectFromOptions 내부의 loader.Load를 살펴보겠습니다.\ncompose-spec compose-go loader loader.go#L145\nfunc Load(configDetails types.ConfigDetails, options ...func(*Options)) (*types.Project, error) { if len(configDetails.ConfigFiles) \u003c 1 { return nil, errors.Errorf(\"No files specified\") } ... if !opts.SkipNormalization { err = normalize(project, opts.ResolvePaths) if err != nil { return nil, err } } ... opts.SkipNormalization의 기본값은 false이며 normalize가 실행되게 됩니다.\ncompose-spec compose-go loader normalize.go#L31\n// normalize compose project by moving deprecated attributes to their canonical position and injecting implicit defaults func normalize(project *types.Project, resolvePaths bool) error { absWorkingDir, err := filepath.Abs(project.WorkingDir) if err != nil { return err } project.WorkingDir = absWorkingDir ... setNameFromKey(project) ... setNameFromKey 여기서 default Name을 project.Name으로 설정하는 것을 확인할 수 있습니다.\ncompose-spec compose-go loader normalize.go#L146\nfunc setNameFromKey(project *types.Project) { for i, n := range project.Networks { if n.Name == \"\" { n.Name = fmt.Sprintf(\"%s_%s\", project.Name, i) project.Networks[i] = n } } 참고자료\nstack overflow: docker-compose v3 prepend folder name to network name\nhttps://docs.docker.com/compose/compose-file/compose-file-v3/#name-1\nhttps://docs.docker.com/compose/compose-file/compose-versioning/#version-35\nhttps://docs.docker.com/compose/compose-file/compose-file-v3/#container_name\nhttps://github.com/docker/compose/issues/3736\n","wordCount":"1253","inLanguage":"en","datePublished":"2022-03-26T09:00:00+09:00","dateModified":"2022-03-26T09:00:00+09:00","author":{"@type":"Person","name":"Sunghyun Jun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sunghyunjun.github.io/posts/docker-compose-networks-name/"},"publisher":{"@type":"Organization","name":"Sunghyun Jun Dev Note","logo":{"@type":"ImageObject","url":"https://sunghyunjun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sunghyunjun.github.io/ accesskey=h title="Sunghyun Jun Dev Note (Alt + H)">Sunghyun Jun Dev Note</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sunghyunjun.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://sunghyunjun.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sunghyunjun.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://sunghyunjun.github.io/posts/>Posts</a></div><h1 class=post-title>Docker Compose Networks 이름 설정하기</h1><div class=post-meta><span title='2022-03-26 09:00:00 +0900 +0900'>March 26, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1253 words&nbsp;·&nbsp;Sunghyun Jun</div></header><div class=post-content><p>Docker Compose networks 설정을 했을 때, <code>docker network ls</code>를 하여 network name을 확인해보면 특정 형태의 접두사가 포함되곤 합니다.</p><p>이 글에서는 network name 접두사가 어떻게 생성되는지 확인해보고, 접두사 없이 network name을 내가 원하는 name으로 설정할 수 있는 지를 알아보려고 합니다.</p><p><strong><code>docker-compose-without-networks-name.yml</code></strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.9&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hello-world</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hello-world:latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>foobar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># without name property</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>foobar</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-without-networks-name.yml up
</span></span></span><span class=line><span class=cl><span class=go>[+] Running 2/2
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Network mydir_foobar           Created                                                    0.1s
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Container mydir-hello-world-1  Created                                                    0.1s
</span></span></span><span class=line><span class=cl><span class=go>Attaching to mydir-hello-world-1
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  |
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  | Hello from Docker!
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  | This message shows that your installation appears to be working correctly.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ pwd
</span></span></span><span class=line><span class=cl><span class=go>/home/amiere/mydir
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ docker network ls
</span></span></span><span class=line><span class=cl><span class=go>NETWORK ID     NAME                                           DRIVER    SCOPE
</span></span></span><span class=line><span class=cl><span class=go>23aa4273c50b   bridge                                         bridge    local
</span></span></span><span class=line><span class=cl><span class=go>060edc7d35a8   host                                           host      local
</span></span></span><span class=line><span class=cl><span class=go>08126381cd1f   mydir_foobar                                   bridge    local
</span></span></span><span class=line><span class=cl><span class=go>b58714b49b7e   none                                           null      local
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><p>위와 같이 compose yaml을 설정하고, <code>mydir</code> directory에서 <code>docker-compose up</code>을 실행하면 NETWORK NAME이 <code>mydir_foobar</code>로 설정되어 생성되는 것을 확인할 수 있습니다.</p><p>이것을 봐서는 network name의 접두사는 기본적으로 <code>docker-compose</code> 명령어가 실행되는 directory로 보입니다. 정확히는 compose project name이 기본 접두사가 되는데, 자세한 내용은 이 글의 후반부에서 다루겠습니다.</p><p>이번에는 compose yaml을 아래와 같이 변경하고 실행을 해보겠습니다. 차이점은 networks 부분에 <code>name</code>이라는 하위 key를 추가로 설정해준 것입니다. 이 설정은 compose file version 3.5 이상에서 적용 가능합니다.</p><p><a href=https://docs.docker.com/compose/compose-file/compose-versioning/#version-35>Compose file version 3.5</a></p><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#name-1>compose-file-v3/#name-1</a></p><p><strong><code>docker-compose-with-networks-name.yml</code></strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.9&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hello-world</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hello-world:latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>foobar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with name property</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Compose file version &gt;= 3.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># https://docs.docker.com/compose/compose-file/compose-versioning/#version-35</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>foobar</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foobar</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f ./docker-compose-with-networks-name.yml up
</span></span></span><span class=line><span class=cl><span class=go>[+] Running 2/2
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Network foobar                 Created                                                    0.1s
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Container mydir-hello-world-1  Created                                                    1.0s
</span></span></span><span class=line><span class=cl><span class=go>Attaching to mydir-hello-world-1
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  |
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  | Hello from Docker!
</span></span></span><span class=line><span class=cl><span class=go>mydir-hello-world-1  | This message shows that your installation appears to be working correctly.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ docker network ls
</span></span></span><span class=line><span class=cl><span class=go>NETWORK ID     NAME                                           DRIVER    SCOPE
</span></span></span><span class=line><span class=cl><span class=go>23aa4273c50b   bridge                                         bridge    local
</span></span></span><span class=line><span class=cl><span class=go>14f095601a79   foobar                                         bridge    local
</span></span></span><span class=line><span class=cl><span class=go>060edc7d35a8   host                                           host      local
</span></span></span><span class=line><span class=cl><span class=go>b58714b49b7e   none                                           null      local
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><p>network 하위 key로 <code>name</code>을 설정하면 위와 같이 접두사 없이 <code>name</code>에서 설정한 이름으로 NETWORK NAME이 설정됩니다.</p><p>compose file version 3.5 이상에서는 <code>networks</code>에 대해 하위 key <code>name</code>을 사용하여 기본적으로 생성되는 접두사 없이 NETWORK NAME을 설정할 수 있습니다.</p><p>한편으로 위의 과정을 살펴보시면 <code>docker-compose up</code>에서 생성되는 container의 이름 또한 자동으로 접두사가 생성되는 것을 확인할 수 있습니다.</p><p>이 부분을 변경하고자 할 경우에는 <code>services</code> 하위 key로 <code>container_name</code>을 설정하면 됩니다.</p><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#container_name>compose-file-v3/#container_name</a></p><p><strong><code>docker-compose-with-name.yml</code></strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.9&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hello-world</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>hello-foobar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;hello-world:latest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>foobar</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># with name property</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Compose file version &gt;= 3.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># https://docs.docker.com/compose/compose-file/compose-versioning/#version-35</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>foobar</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>bridge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foobar</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>amiere@LAPTOP-5BV4FPUC:~/mydir$ docker-compose -f docker-compose-with-name.yml up
</span></span></span><span class=line><span class=cl><span class=go>[+] Running 2/2
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Network foobar          Created                                                                                 0.0s
</span></span></span><span class=line><span class=cl><span class=go> ⠿ Container hello-foobar  Created                                                                                 0.2s
</span></span></span><span class=line><span class=cl><span class=go>Attaching to hello-foobar
</span></span></span><span class=line><span class=cl><span class=go>hello-foobar  |
</span></span></span><span class=line><span class=cl><span class=go>hello-foobar  | Hello from Docker!
</span></span></span><span class=line><span class=cl><span class=go>hello-foobar  | This message shows that your installation appears to be working correctly.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><p>위와 같이 container 이름이 접두사 없이 <code>hello-foobar</code>로 설정된 것을 확인할 수 있습니다. <code>container_name</code>의 경우, 아래와 같은 주의사항이 있습니다.</p><blockquote><ul><li>Note when using docker stack deploy<br>The container_name option is ignored when deploying a stack in swarm mode</li></ul></blockquote><hr><h2 id=docker-compose-networks-name-default-prefix>Docker Compose networks name default prefix<a hidden class=anchor aria-hidden=true href=#docker-compose-networks-name-default-prefix>#</a></h2><p>networks name 기본 접두사는 어떻게 설정되는 것인지 알아보고자 합니다.</p><p>docker-compose는 cobra library를 사용합니다.</p><p><a href=https://github.com/spf13/cobra>Cobra is a library for creating powerful modern CLI applications.</a></p><p>우리가 사용하는 docker-compose 명령어는 아래에서 시작합니다.</p><p>아래의 github source code permalink는 2022년 3월 26일을 기준으로 하였습니다.</p><p><a href=https://github.com/docker/compose/blob/v2/cmd/compose/compose.go#L228>docker compose v2 compose.go#L228</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>RootCommand</span><span class=p>(</span><span class=nx>dockerCli</span> <span class=nx>command</span><span class=p>.</span><span class=nx>Cli</span><span class=p>,</span> <span class=nx>backend</span> <span class=nx>api</span><span class=p>.</span><span class=nx>Service</span><span class=p>)</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>opts</span> <span class=o>:=</span> <span class=nx>projectOptions</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>ansi</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>noAnsi</span>  <span class=kt>bool</span>
</span></span><span class=line><span class=cl>		<span class=nx>verbose</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>		<span class=nx>version</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>command</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Short</span><span class=p>:</span>            <span class=s>&#34;Docker Compose&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Use</span><span class=p>:</span>              <span class=nx>PluginName</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>TraverseChildren</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><a href=https://github.com/docker/compose/blob/v2/cmd/compose/compose.go#L293>docker compose v2 compose.go#L293</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>command</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nf>upCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>backend</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nf>downCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>backend</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nf>startCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>backend</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nf>restartCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>backend</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nf>stopCommand</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>opts</span><span class=p>,</span> <span class=nx>backend</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>upCommand</code>, <code>downCommand</code> 등이 우리가 <code>docker-compose up</code>와 같은 명령어를 사용하는 것과 관련 있는 부분입니다.</p><p><a href=https://github.com/docker/compose/blob/be187bae649521f5776033284a511da0fbaf8058/cmd/compose/up.go#L95>docker compose v2 up.go#L95</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>upCommand</span><span class=p>(</span><span class=nx>p</span> <span class=o>*</span><span class=nx>projectOptions</span><span class=p>,</span> <span class=nx>backend</span> <span class=nx>api</span><span class=p>.</span><span class=nx>Service</span><span class=p>)</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>up</span> <span class=o>:=</span> <span class=nx>upOptions</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>create</span> <span class=o>:=</span> <span class=nx>createOptions</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=nx>upCmd</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;up [SERVICE...]&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Create and start containers&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>PreRunE</span><span class=p>:</span> <span class=nf>AdaptCmd</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>create</span><span class=p>.</span><span class=nx>timeChanged</span> <span class=p>=</span> <span class=nx>cmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>Changed</span><span class=p>(</span><span class=s>&#34;timeout&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nf>validateFlags</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>up</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>create</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}),</span>
</span></span><span class=line><span class=cl>		<span class=nx>RunE</span><span class=p>:</span> <span class=nx>p</span><span class=p>.</span><span class=nf>WithServices</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>project</span> <span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>,</span> <span class=nx>services</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>create</span><span class=p>.</span><span class=nx>ignoreOrphans</span> <span class=p>=</span> <span class=nx>utils</span><span class=p>.</span><span class=nf>StringToBool</span><span class=p>(</span><span class=nx>project</span><span class=p>.</span><span class=nx>Environment</span><span class=p>[</span><span class=s>&#34;COMPOSE_IGNORE_ORPHANS&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>create</span><span class=p>.</span><span class=nx>ignoreOrphans</span> <span class=o>&amp;&amp;</span> <span class=nx>create</span><span class=p>.</span><span class=nx>removeOrphans</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;COMPOSE_IGNORE_ORPHANS and --remove-orphans cannot be combined&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nf>runUp</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>backend</span><span class=p>,</span> <span class=nx>create</span><span class=p>,</span> <span class=nx>up</span><span class=p>,</span> <span class=nx>project</span><span class=p>,</span> <span class=nx>services</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p>여기서 <code>WithServices</code> 부분을 살펴보면 다음과 같습니다.</p><p><a href=https://github.com/docker/compose/blob/be187bae649521f5776033284a511da0fbaf8058/cmd/compose/compose.go#L119>docker compose v2 compose.go#L119</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// WithServices creates a cobra run command from a ProjectFunc based on configured project options and selected services
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>projectOptions</span><span class=p>)</span> <span class=nf>WithServices</span><span class=p>(</span><span class=nx>fn</span> <span class=nx>ProjectServicesFunc</span><span class=p>)</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nf>Adapt</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>project</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>o</span><span class=p>.</span><span class=nf>toProject</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=nx>cli</span><span class=p>.</span><span class=nf>WithResolvedPaths</span><span class=p>(</span><span class=kc>true</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nf>fn</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>project</span><span class=p>,</span> <span class=nx>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>여기서 <code>toProject</code> 를 살펴보면 아래와 같습니다.</p><p><a href=https://github.com/docker/compose/blob/be187bae649521f5776033284a511da0fbaf8058/cmd/compose/compose.go#L153>docker compose v2 compose.go#L153</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>projectOptions</span><span class=p>)</span> <span class=nf>toProject</span><span class=p>(</span><span class=nx>services</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>po</span> <span class=o>...</span><span class=nx>cli</span><span class=p>.</span><span class=nx>ProjectOptionsFn</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>options</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>o</span><span class=p>.</span><span class=nf>toProjectOptions</span><span class=p>(</span><span class=nx>po</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>compose</span><span class=p>.</span><span class=nf>WrapComposeError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>project</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cli</span><span class=p>.</span><span class=nf>ProjectFromOptions</span><span class=p>(</span><span class=nx>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>compose</span><span class=p>.</span><span class=nf>WrapComposeError</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>toProjectOptions</code>와 <code>cli.ProjectFromOptions</code>를 살펴보겠습니다.</p><p>먼저 <code>toProjectOptions</code> 를 살펴보면 아래와 같습니다.</p><p><a href=https://github.com/docker/compose/blob/be187bae649521f5776033284a511da0fbaf8058/cmd/compose/compose.go#L207>docker compose v2 compose.go#L207</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>projectOptions</span><span class=p>)</span> <span class=nf>toProjectOptions</span><span class=p>(</span><span class=nx>po</span> <span class=o>...</span><span class=nx>cli</span><span class=p>.</span><span class=nx>ProjectOptionsFn</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>cli</span><span class=p>.</span><span class=nx>ProjectOptions</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>cli</span><span class=p>.</span><span class=nf>NewProjectOptions</span><span class=p>(</span><span class=nx>o</span><span class=p>.</span><span class=nx>ConfigPaths</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nb>append</span><span class=p>(</span><span class=nx>po</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nf>WithWorkingDirectory</span><span class=p>(</span><span class=nx>o</span><span class=p>.</span><span class=nx>ProjectDir</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nf>WithEnvFile</span><span class=p>(</span><span class=nx>o</span><span class=p>.</span><span class=nx>EnvFile</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nx>WithDotEnv</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nx>WithOsEnv</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nx>WithConfigFileEnv</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nx>WithDefaultConfigPath</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>cli</span><span class=p>.</span><span class=nf>WithName</span><span class=p>(</span><span class=nx>o</span><span class=p>.</span><span class=nx>ProjectName</span><span class=p>))</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>cli.WithName(o.ProjectNme)</code>과 관련하여 아래와 같이 살펴볼 수 있습니다.</p><p>우선 <code>o.ProjectName</code>은 <code>addProjectFlags</code>에서 설정이 되는데, 이는 우리가 <code>docker-compose -p NAME</code> 옵션을 사용했을 때 설정이 되는 부분입니다.</p><p>우리가 지정한 NAME 을 갖거나, default로 &ldquo;&ldquo;으로 설정됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Define and run multi-container applications with Docker.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Usage:
</span></span></span><span class=line><span class=cl><span class=go>  docker-compose [-f &lt;arg&gt;...] [--profile &lt;name&gt;...] [options] [COMMAND] [ARGS...]
</span></span></span><span class=line><span class=cl><span class=go>  docker-compose -h|--help
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Options:
</span></span></span><span class=line><span class=cl><span class=go>  -f, --file FILE             Specify an alternate compose file
</span></span></span><span class=line><span class=cl><span class=go>                              (default: docker-compose.yml)
</span></span></span><span class=line><span class=cl><span class=go>  -p, --project-name NAME     Specify an alternate project name
</span></span></span><span class=line><span class=cl><span class=go>                              (default: directory name)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...
</span></span></span></code></pre></div><p><a href=https://github.com/docker/compose/blob/be187bae649521f5776033284a511da0fbaf8058/cmd/compose/compose.go#L130>docker compose v2 compose.go#L130</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>projectOptions</span><span class=p>)</span> <span class=nf>addProjectFlags</span><span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>pflag</span><span class=p>.</span><span class=nx>FlagSet</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>f</span><span class=p>.</span><span class=nf>StringArrayVar</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>Profiles</span><span class=p>,</span> <span class=s>&#34;profile&#34;</span><span class=p>,</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span> <span class=s>&#34;Specify a profile to enable&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>f</span><span class=p>.</span><span class=nf>StringVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>o</span><span class=p>.</span><span class=nx>ProjectName</span><span class=p>,</span> <span class=s>&#34;project-name&#34;</span><span class=p>,</span> <span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=s>&#34;Project name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>cli.WithName(o.ProjectNme)</code>의 <code>WithName</code>은 아래와 같습니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/cli/options.go#L63>compose-spec compose-go cli options.go#L63</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>WithName</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>ProjectOptionsFn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>ProjectOptions</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>o</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=nx>name</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>이제 약간 다시 돌아와서 <code>cli.ProjectFromOptions</code>를 살펴보겠습니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/cli/options.go#L296>compose-spec compose-go cli options.go#L296</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>ProjectFromOptions</span><span class=p>(</span><span class=nx>options</span> <span class=o>*</span><span class=nx>ProjectOptions</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>configPaths</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>getConfigPathsFromOptions</span><span class=p>(</span><span class=nx>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>workingDir</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>options</span><span class=p>.</span><span class=nf>GetWorkingDir</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>absWorkingDir</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>filepath</span><span class=p>.</span><span class=nf>Abs</span><span class=p>(</span><span class=nx>workingDir</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>options</span><span class=p>.</span><span class=nx>loadOptions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>loadOptions</span><span class=p>,</span> <span class=nf>withNamePrecedenceLoad</span><span class=p>(</span><span class=nx>absWorkingDir</span><span class=p>,</span> <span class=nx>options</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>project</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>loader</span><span class=p>.</span><span class=nf>Load</span><span class=p>(</span><span class=nx>types</span><span class=p>.</span><span class=nx>ConfigDetails</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ConfigFiles</span><span class=p>:</span> <span class=nx>configs</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>WorkingDir</span><span class=p>:</span>  <span class=nx>workingDir</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Environment</span><span class=p>:</span> <span class=nx>options</span><span class=p>.</span><span class=nx>Environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=nx>options</span><span class=p>.</span><span class=nx>loadOptions</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>absWorkingDir</code>, <code>withNamePrecedenceLoad(absWorkingDir, options)</code>을 살펴보겠습니다. 그리고 이어서 <code>loader.Load</code>를 살펴보겠습니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/cli/options.go#L350>compose-spec compose-go cli options.go#L350</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>withNamePrecedenceLoad</span><span class=p>(</span><span class=nx>absWorkingDir</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>options</span> <span class=o>*</span><span class=nx>ProjectOptions</span><span class=p>)</span> <span class=kd>func</span><span class=p>(</span><span class=o>*</span><span class=nx>loader</span><span class=p>.</span><span class=nx>Options</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>opts</span> <span class=o>*</span><span class=nx>loader</span><span class=p>.</span><span class=nx>Options</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>options</span><span class=p>.</span><span class=nx>Name</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>opts</span><span class=p>.</span><span class=nf>SetProjectName</span><span class=p>(</span><span class=nx>options</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>nameFromEnv</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>options</span><span class=p>.</span><span class=nx>Environment</span><span class=p>[</span><span class=nx>consts</span><span class=p>.</span><span class=nx>ComposeProjectName</span><span class=p>];</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>nameFromEnv</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>opts</span><span class=p>.</span><span class=nf>SetProjectName</span><span class=p>(</span><span class=nx>nameFromEnv</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>opts</span><span class=p>.</span><span class=nf>SetProjectName</span><span class=p>(</span><span class=nx>filepath</span><span class=p>.</span><span class=nf>Base</span><span class=p>(</span><span class=nx>absWorkingDir</span><span class=p>),</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>바로 여기서 <code>options.Name == ""</code> 일 경우에 <code>opts.SetProjcetName</code> 기본 설정이 이루어지게 됩니다.
<code>docker compose -p NAME</code>의 NAME을 전달하지 않을 경우 이곳에서 환경설정을 통해 설정이 되거나 <code>filepath.Base(absWorkingDir)</code>에 의해 설정되게 됩니다.</p><p>즉 docker compose project name이 절대경로 이름의 base가 되는 것입니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/loader/loader.go#L70>compose-spec compose-go loader loader.go#L70</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>o</span> <span class=o>*</span><span class=nx>Options</span><span class=p>)</span> <span class=nf>SetProjectName</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>imperativelySet</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>o</span><span class=p>.</span><span class=nx>projectName</span> <span class=p>=</span> <span class=nf>normalizeProjectName</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>o</span><span class=p>.</span><span class=nx>projectNameImperativelySet</span> <span class=p>=</span> <span class=nx>imperativelySet</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>이제 <code>cli.ProjectFromOptions</code> 내부의 <code>loader.Load</code>를 살펴보겠습니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/loader/loader.go#L145>compose-spec compose-go loader loader.go#L145</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Load</span><span class=p>(</span><span class=nx>configDetails</span> <span class=nx>types</span><span class=p>.</span><span class=nx>ConfigDetails</span><span class=p>,</span> <span class=nx>options</span> <span class=o>...</span><span class=kd>func</span><span class=p>(</span><span class=o>*</span><span class=nx>Options</span><span class=p>))</span> <span class=p>(</span><span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>configDetails</span><span class=p>.</span><span class=nx>ConfigFiles</span><span class=p>)</span> <span class=p>&lt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;No files specified&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>opts</span><span class=p>.</span><span class=nx>SkipNormalization</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>err</span> <span class=p>=</span> <span class=nf>normalize</span><span class=p>(</span><span class=nx>project</span><span class=p>,</span> <span class=nx>opts</span><span class=p>.</span><span class=nx>ResolvePaths</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>opts.SkipNormalization</code>의 기본값은 false이며 <code>normalize</code>가 실행되게 됩니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/loader/normalize.go#L31>compose-spec compose-go loader normalize.go#L31</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// normalize compose project by moving deprecated attributes to their canonical position and injecting implicit defaults
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>normalize</span><span class=p>(</span><span class=nx>project</span> <span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>,</span> <span class=nx>resolvePaths</span> <span class=kt>bool</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>absWorkingDir</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>filepath</span><span class=p>.</span><span class=nf>Abs</span><span class=p>(</span><span class=nx>project</span><span class=p>.</span><span class=nx>WorkingDir</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>project</span><span class=p>.</span><span class=nx>WorkingDir</span> <span class=p>=</span> <span class=nx>absWorkingDir</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nf>setNameFromKey</span><span class=p>(</span><span class=nx>project</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><p><code>setNameFromKey</code> 여기서 default Name을 project.Name으로 설정하는 것을 확인할 수 있습니다.</p><p><a href=https://github.com/compose-spec/compose-go/blob/e3cf2790536b2a6110a5f9cd81da580775d1f9c4/loader/normalize.go#L146>compose-spec compose-go loader normalize.go#L146</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>setNameFromKey</span><span class=p>(</span><span class=nx>project</span> <span class=o>*</span><span class=nx>types</span><span class=p>.</span><span class=nx>Project</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>n</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>project</span><span class=p>.</span><span class=nx>Networks</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>n</span><span class=p>.</span><span class=nx>Name</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>n</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s_%s&#34;</span><span class=p>,</span> <span class=nx>project</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>project</span><span class=p>.</span><span class=nx>Networks</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>n</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></div><p>참고자료</p><p><a href=https://stackoverflow.com/questions/42570539/docker-compose-v3-prepend-folder-name-to-network-name>stack overflow: docker-compose v3 prepend folder name to network name</a></p><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#name-1>https://docs.docker.com/compose/compose-file/compose-file-v3/#name-1</a></p><p><a href=https://docs.docker.com/compose/compose-file/compose-versioning/#version-35>https://docs.docker.com/compose/compose-file/compose-versioning/#version-35</a></p><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v3/#container_name>https://docs.docker.com/compose/compose-file/compose-file-v3/#container_name</a></p><p><a href=https://github.com/docker/compose/issues/3736>https://github.com/docker/compose/issues/3736</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://sunghyunjun.github.io/tags/docker-compose/>docker-compose</a></li></ul><nav class=paginav><a class=prev href=https://sunghyunjun.github.io/posts/shared-library-path-with-cgo/><span class=title>« Prev</span><br><span>Shared Library Path 이해와 cgo 사용하기</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on twitter" href="https://twitter.com/intent/tweet/?text=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0&url=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f&hashtags=docker-compose"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f&title=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0&summary=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0&source=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f&title=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on whatsapp" href="https://api.whatsapp.com/send?text=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0%20-%20https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Compose Networks 이름 설정하기 on telegram" href="https://telegram.me/share/url?text=Docker%20Compose%20Networks%20%ec%9d%b4%eb%a6%84%20%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0&url=https%3a%2f%2fsunghyunjun.github.io%2fposts%2fdocker-compose-networks-name%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://sunghyunjun.github.io/>Sunghyun Jun Dev Note</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>